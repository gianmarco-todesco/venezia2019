"use strict";

class PolyhedronData {
    constructor(pts, faces) {
        const m4 = twgl.m4;
        const v3 = twgl.v3;
        const p0 = v3.create(pts[0][0], pts[0][1], pts[0][2]);
        const sc = 1.0/v3.length(p0);
        this.vertices = pts.map(c=>v3.create(sc*c[0],sc*c[1],sc*c[2]));
        this.faces = faces;
        const edges = this.edges = [];
        const edgesTb = {};
        this.centers = [];
        this.rotations = [];
        const me = this;
        faces.forEach(f=>{
            const m = f.length;
            for(var i=0;i<m;i++) {
                const a = f[i];
                const b = f[(i+1)%m];
                const abId = a>b ? a+"_"+b : b+"_"+a;
                if(!edgesTb[abId]) { edgesTb[abId] = [a,b]; edges.push([a,b]); }; 
            }

            const fPts = f.map(i=>me.vertices[i]);
            const pc = v3.divScalar(fPts.reduce((a,b)=>v3.add(a,b)), m);
            me.centers.push(pc);

            const pa = fPts[0];
            const e0 = v3.normalize(v3.subtract(pa,pc));
            const e2 = v3.normalize(pc);
            const e1 = v3.cross(e2,e0);

            this.rotations.push(new Float32Array([
                e0[0],e0[1],e0[2],0,
                e1[0],e1[1],e1[2],0,
                e2[0],e2[1],e2[2],0,
                0,0,0,1]));

        });
        this.edgeLength = v3.length(v3.subtract(
            this.vertices[this.edges[0][0]],
            this.vertices[this.edges[0][1]] ));
        this.inRadius = v3.length(this.centers[0]);
        this.outRadius = v3.length(this.vertices[0]);
    }
}

const regularPolyhedra = {
    tetrahedron : new PolyhedronData(
        [
            [-0.57735,-0.57735,-0.57735], [0.57735,0.57735,-0.57735], 
            [0.57735,-0.57735,0.57735], [-0.57735,0.57735,0.57735]
        ],
        [
            [0,1,2], [1,0,3], [2,1,3], [0,2,3]
        ]
    ),
    cube : new PolyhedronData( 
        [
            [-0.57735,-0.57735,-0.57735], [0.57735,-0.57735,-0.57735], 
            [-0.57735,0.57735,-0.57735], [0.57735,0.57735,-0.57735], 
            [-0.57735,-0.57735,0.57735], [0.57735,-0.57735,0.57735], 
            [-0.57735,0.57735,0.57735], [0.57735,0.57735,0.57735]
        ],
        [
            [0,2,3,1], [1,5,4,0], [3,7,5,1], [2,6,7,3], [0,4,6,2], [4,5,7,6]
        ]
    ),    
    octahedron : new PolyhedronData( 
        [
            [0,0,-1], [0,0,1], [0,-1,0], [0,1,0], [-1,0,0], [1,0,0]
        ],
        [
            [0,3,5], [0,4,3], [0,2,4], [0,5,2], [1,5,3], [1,3,4], [1,4,2], [1,2,5]
        ]
    ),    
    dodecahedron : new PolyhedronData(
        [
            [0.607062,0,0.794654], [0.982247,0,0.187592], [0.187592,0.57735,0.794654], [0.303531,0.934172,0.187592],
            [-0.491124,0.356822,0.794654], [-0.794655,0.57735,0.187592], [-0.491123,-0.356822,0.794654], [-0.794654,-0.577351,0.187592], 
            [0.187593,-0.57735,0.794654], [0.303532,-0.934172,0.187592], [-0.303532,0.934172,-0.187592], [-0.187593,0.57735,-0.794654], 
            [0.794654,0.577351,-0.187592], [0.491123,0.356822,-0.794654], [0.794655,-0.57735,-0.187592], [0.491124,-0.356822,-0.794654], 
            [-0.303531,-0.934172,-0.187592], [-0.187592,-0.57735,-0.794654], [-0.982247,0,-0.187592], [-0.607062,0,-0.794654]
        ],
        [
            [0,2,4,6,8], [2,0,1,12,3], [0,8,9,14,1], [8,6,7,16,9], [6,4,5,18,7], [4,2,3,10,5], 
            [3,12,13,11,10], [1,14,15,13,12], [9,16,17,15,14], [7,18,19,17,16], [5,10,11,19,18], [11,13,15,17,19]
        ]        
    ),
    icosahedron : new PolyhedronData(
        [
            [-0.525731,-0.850651,0], [0.525731,-0.850651,0], [-0.525731,0.850651,0], 
            [0.525731,0.850651,0], [-0.850651,0,-0.525731], [-0.850651,0,0.525731], 
            [0.850651,0,-0.525731], [0.850651,0,0.525731], [0,-0.525731,-0.850651], 
            [0,0.525731,-0.850651], [0,-0.525731,0.850651], [0,0.525731,0.850651]
        ],
        [
            [3,9,2], [6,9,3], [8,9,6], [4,9,8], [2,9,4], 
            [1,10,0], [0,10,5], [5,10,11], [10,7,11], [7,10,1],
            [2,5,11], [3,11,7], [1,6,7], [0,8,1], [4,0,5], 
            [2,11,3], [3,7,6], [6,1,8], [4,8,0],[2,4,5]    
        ]
    ),
};


